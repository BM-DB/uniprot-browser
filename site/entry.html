<!-- site/entry.html — replace entire file -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Entry</title>
  <link rel="stylesheet" href="styles.css" />
  <style>
    .viewer-card {
      width: 100%;
      border: 1px solid #ddd;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 16px;
      background: #fff;
    }
    #viewer-frame { width: 100%; height: 640px; border: 0; display: block; }
    .meta { display: flex; gap: 12px; align-items: center; margin: 8px 0 16px; }
    .meta a { text-decoration: none; }
    .error { color:#b00020; margin-top:8px; }
    .btn { padding: 6px 10px; border:1px solid #ddd; border-radius:6px; cursor:pointer; }
  </style>
</head>
<body>
  <a href="index.html">← Back</a>
  <h1 id="title"></h1>

  <div class="viewer-card">
    <iframe id="viewer-frame" src="about:blank"></iframe>
  </div>

  <div class="meta">
    <strong>Files:</strong>
    <a id="cifLink"   target="_blank" rel="noopener">CIF</a>
    <a id="fastaLink" target="_blank" rel="noopener">FASTA</a>
    <button id="copyBtn" class="btn" type="button">Copy FASTA</button>
  </div>

  <div id="err" class="error"></div>

  <h2>Sequence (FASTA)</h2>
  <pre id="fasta">Loading...</pre>

  <script>
    function getParam(name){ return new URL(location.href).searchParams.get(name); }

    async function load(){
      const uid      = getParam('uid');
      const errEl    = document.getElementById('err');
      const titleEl  = document.getElementById('title');
      const fastaEl  = document.getElementById('fasta');
      const cifLink  = document.getElementById('cifLink');
      const fastaLink= document.getElementById('fastaLink');
      const frame    = document.getElementById('viewer-frame');
      const copyBtn  = document.getElementById('copyBtn');

      titleEl.textContent = uid || '(missing uid)';

      // cache-bust catalog
      let catalog;
      try {
        catalog = await fetch('../data/entries.json?v=' + Date.now()).then(r=>r.json());
      } catch {
        errEl.textContent = 'Could not load entries.json.'; return;
      }

      const entry = catalog.entries.find(e => e.uniprot_id === uid);
      if(!entry){ errEl.textContent = 'Entry not found in catalog.'; return; }

      // Wire file links
      cifLink.href   = entry.files.structure_cif;
      fastaLink.href = entry.files.sequence_fasta;

      // Load FASTA text
      try {
        const t = await fetch(entry.files.sequence_fasta).then(r=>r.text());
        fastaEl.textContent = t;
        copyBtn.onclick = async () => {
          await navigator.clipboard.writeText(t);
          copyBtn.textContent = 'Copied!';
          setTimeout(()=> (copyBtn.textContent = 'Copy FASTA'), 1200);
        };
      } catch {
        fastaEl.textContent = 'FASTA not available.';
        copyBtn.disabled = true;
      }

      // Point the iframe to viewer-frame.html with the CIF URL as query param
      const encodedUrl = encodeURIComponent(entry.files.structure_cif);
      frame.src = `viewer-frame.html?url=${encodedUrl}&v=1`;
    }

    load();
  </script>
</body>
</html>

