<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Mol* Core Viewer (Minimal)</title>

  <!-- Pin Mol* core to a stable version -->
  <script src="https://unpkg.com/molstar@3.43.0/build/viewer/molstar.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/molstar@3.43.0/build/viewer/molstar.css" />

  <style>
    html, body { margin: 0; width: 100%; height: 100%; background: #fff; }
    #viewer { width: 100%; height: 100%; }
    /* Safety: hide any residual chrome if present */
    .msp-left-panel, .msp-right-panel, .msp-bottom-panel,
    .msp-layout-controls, .msp-viewport-controls,
    .msp-help-toast, .msp-plugin-ui { display: none !important; }
    #viewer .msp-viewport, #viewer canvas {
      width: 100% !important; height: 100% !important;
      max-width: 100% !important; max-height: 100% !important;
    }
  </style>
</head>
<body>
  <div id="viewer"></div>
  <script>
    // Read ?url=... (encoded) and optional ?format=cif|mmcif
    const params = new URL(location.href).searchParams;
    const url    = params.get('url');
    const fmtQ   = params.get('format'); // optional override

    // Create Mol* core viewer in minimal mode
    const v = new molstar.Viewer('viewer', {
      layoutShowControls: false,
      viewportShowExpand: false,
      layoutIsExpanded: false,
      showImportControls: false,
      bgColor: { r: 255, g: 255, b: 255 },
      powerPreference: 'high-performance',
      graphicsMode: 'quality'
    });

    async function load(format) {
      await v.loadStructureFromUrl(url, format);  // 'mmcif' or 'cif'
      v.resetCamera();
    }

    (async () => {
      if (!url) return;
      try {
        await load(fmtQ || 'mmcif');
      } catch (e1) {
        console.warn('mmcif failed, retrying as cif', e1);
        try { await load('cif'); } catch (e2) { console.error('cif failed', e2); }
      }
    })();
  </script>
</body>
</html>
